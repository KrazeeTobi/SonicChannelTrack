(function(){const a={score:"nes_xtechexpotky2022_score",booth:"nes_xtechexpotky2022_booth",category:"nes_xtechexpotky2022_category"};$(function(){const j=function(m){const n=$.Deferred();$.ajax({url:"/pds/userdb/?MAXCNT=200&service="+a.booth,type:"get"}).done(function(o){let id="";let isRegistered=false;o.data.forEach(function(p){if(p.obj.url==m){id=p.id;isRegistered=true}});n.resolve({isRegistered:isRegistered,id:id})}).fail(function(){n.reject()});return n.promise()};const h=$(".article_action_btn_label.-clip");if(h.length>0&&!h.hasClass("applyForGuest")){var k=h.attr("data-boothurl");$.ajax({url:"/pds/userdb/?MAXCNT=200&service="+a.booth,type:"get"}).done(function(n){const m=[];n.data.forEach(function(o){m.push(o.obj.url)});for(let i=0;i<n.data.length;i++){if(n.data[i].obj.url===k){h.attr("data-did",n.data[i].id)}}if(m.indexOf(k)>-1){h.addClass("-clipped");h.attr("title","気になるブースから削除する")}else{h.removeClass("-clipped");h.attr("title","気になるブースに追加する")}e()})}function e(){h.on("click",function(){h.css("pointer-events","none");if(h.hasClass("-clipped")){const o=h.attr("data-did");g(o);h.attr("title","気になるブースに追加する")}else{const n={url:h.attr("data-boothurl"),exhibitname:h.attr("data-exhibitname"),exhibitid:h.attr("data-exhibitid"),site:"NES"};const m={obj:JSON.stringify(n),service:a.booth,callback:"",chk_token:$('meta[name="bpcmstokenmydata"]').attr("content")};j(h.attr("data-boothurl")).then(function(p){if(p.isRegistered){h.addClass("-clipped");h.after('<span class="-clip_text">気になるブースに追加済みです</span>');h.attr("data-did",p.id);h.attr("title","気になるブースから削除する");setTimeout(function(){h.closest("li").find(".-clip_text").css("display","none");h.css("pointer-events","auto")}.bind(this),1000)}else{$.ajax({type:"POST",url:"/pds/userdb/create/",dataType:"json",data:m}).done(function(q){if(q.statusCode=="200"){h.addClass("-clipped");h.after('<span class="-clip_text">気になるブースに追加しました</span>');h.attr("data-did",q.data.id);h.attr("title","気になるブースから削除する");setTimeout(function(){h.closest("li").find(".-clip_text").css("display","none");h.css("pointer-events","auto")}.bind(this),1000)}else{if(q.errorReason=="EXCEED_ENTRIES"){alert("「気になるブース」は最大200件です。");h.css("pointer-events","auto")}else{if(q.errorReason=="TOKEN_TIMEOUT"){alert("接続の有効時間が切れました。ページを再読み込みの上、改めて設定してください。");h.css("pointer-events","auto")}}}return false})}}).fail(function(){alert("エラーが発生しました。ページを再読み込みの上、改めて設定してください。");h.css("pointer-events","auto")})}return false})}function g(m){$.ajax({type:"GET",url:"/pds/userdb/delete/"+m,dataType:"json",data:{chk_token:$('meta[name="bpcmstokenmydata"]').attr("content")}}).done(function(n){if(n.statusCode=="200"||n.errorReason=="INVALID_OBJ_ID"){h.removeClass("-clipped");h.css("pointer-events","auto");h.attr("data-did")}})}const l=$(".shareBox_action_btn_label.-clip");if(l.length>0&&!l.hasClass("applyForGuest")){var k=l.attr("data-boothurl");$.ajax({url:"/pds/userdb/?MAXCNT=200&service="+a.booth,type:"get"}).done(function(n){const m=[];n.data.forEach(function(o){m.push(o.obj.url)});for(let i=0;i<n.data.length;i++){if(n.data[i].obj.url==k){l.attr("data-did",n.data[i].id)}}if(m.indexOf(k)>-1){l.addClass("-clipped").text("気になるブースに追加済")}else{l.removeClass("-clipped");l.text("気になるブースに追加")}f()})}function f(){l.on("click",function(){l.css("pointer-events","none");if(l.hasClass("-clipped")){const o=l.attr("data-did");d(o);l.text("気になるブースに追加")}else{const n={url:l.attr("data-boothurl"),exhibitname:l.attr("data-exhibitname"),exhibitid:l.attr("data-exhibitid"),site:"NES"};const m={obj:JSON.stringify(n),service:a.booth,callback:"",chk_token:$('meta[name="bpcmstokenmydata"]').attr("content")};j(l.attr("data-boothurl")).then(function(p){if(p.isRegistered){l.addClass("-clipped").text("気になるブースに追加済");$.magnificPopup.close();$(".js-modalShare").after('<span class="-clip_text -clipped">気になるブースに<br>追加済みです</span>');l.attr("data-did",p.id);setTimeout(function(){$(".fixedShare .-clip_text").remove();l.css("pointer-events","auto")}.bind(this),2000)}else{$.ajax({type:"POST",url:"/pds/userdb/create/",dataType:"json",data:m}).done(function(q){if(q.statusCode=="200"){l.addClass("-clipped").text("気になるブースに追加済");$.magnificPopup.close();$(".js-modalShare").after('<span class="-clip_text -clipped">気になるブースに<br>追加しました</span>');l.attr("data-did",q.data.id);setTimeout(function(){$(".fixedShare .-clip_text").remove();l.css("pointer-events","auto")}.bind(this),2000)}else{if(q.errorReason=="EXCEED_ENTRIES"){alert("「気になるブース」は最大200件です。");l.css("pointer-events","auto")}else{if(q.errorReason=="TOKEN_TIMEOUT"){alert("接続の有効時間が切れました。ページを再読み込みの上、改めて設定してください。");l.css("pointer-events","auto")}}}return false})}}).fail(function(){alert("エラーが発生しました。ページを再読み込みの上、改めて設定してください。");l.css("pointer-events","auto")})}return false})}function d(m){$.ajax({type:"GET",url:"/pds/userdb/delete/"+m,dataType:"json",data:{chk_token:$('meta[name="bpcmstokenmydata"]').attr("content")}}).done(function(n){if(n.statusCode=="200"||n.errorReason=="INVALID_OBJ_ID"){$.magnificPopup.close();l.removeClass("-clipped");l.css("pointer-events","auto");l.attr("data-did");l.text("気になるブースに追加")}})}});$(function(){const h=function(k){const l=$.Deferred();$.ajax({url:"/pds/userdb/?MAXCNT=1000&service="+a.score,type:"get"}).done(function(m){let isRegistered=false;m.data.forEach(function(n){if(n.obj.path==k){isRegistered=true}});l.resolve({isRegistered:isRegistered})}).fail(function(){l.reject()});return l.promise()};const g=$("#js-addActionScore");if(g.length>0){const j=g.attr("data-path");$.ajax({url:"/pds/userdb/?MAXCNT=1000&service="+a.score,type:"get"}).done(function(l){const k=[];l.data.forEach(function(m){k.push(m.obj.path)});if(k.indexOf(j)>-1){g.addClass("nolink");g.text("アクションスコアに登録済みです")}else{g.addClass("c-btn").removeClass("nolink");g.closest(".button").addClass("pink");d()}})}function d(){const k={"native-tieups":30,seminars:30,news:30,movies:30,"theme-docs-pages":1,docs:30,"theme-movies-pages":1,novelties:1};g.on("click",function(n){g.css("pointer-events","none");const q=g.attr("data-path");const r=g.attr("data-title");const l=g.attr("data-type");const m=g.attr("data-exhibitname");const p={path:q,title:r,type:l,score:k[l],exhibitName:m,site:"NES"};const o={obj:JSON.stringify(p),service:a.score,callback:"",chk_token:$('meta[name="bpcmstokenmydata"]').attr("content")};h(q).then(function(s){if(s.isRegistered){alert("アクションスコアに登録済みです");g.off("click");g.addClass("nolink").removeClass("c-btn");g.closest(".button").removeClass("pink");g.text("アクションスコアに登録済みです")}else{$.ajax({type:"POST",url:"/pds/userdb/create/",dataType:"json",data:o}).done(function(t){if(t.statusCode=="200"){alert("アクションスコアに登録しました");g.off("click");g.addClass("nolink").removeClass("c-btn");g.closest(".button").removeClass("pink");g.text("アクションスコアに登録済みです")}else{if(t.errorReason=="EXCEED_ENTRIES"){alert("「アクションスコア」は最大1000件です。");g.css("pointer-events","auto")}else{if(t.errorReason=="TOKEN_TIMEOUT"){alert("接続の有効時間が切れました。ページを再読み込みの上、改めて設定してください。");g.css("pointer-events","auto")}}}})}}).fail(function(){alert("エラーが発生しました。ページを再読み込みの上、改めて設定してください。");g.css("pointer-events","auto")});n.preventDefault()})}const f=$("#js-checkActionScore");if(f.length){if(f.data("article")==="seminar"){const e=f.attr("data-path");$.ajax({url:"/pds/userdb/?MAXCNT=1000&service="+a.score,type:"get"}).done(function(l){const k=[];l.data.forEach(function(m){k.push(m.obj.path)});if(k.indexOf(e)>-1){f.text("アクションスコアに登録済みです")}})}}});if($('a[data-atlas-trackable="body_exlink"]').length>0){const b=$('meta[name="movielogid"]').attr("content");const c=$('meta[name="seminarcode"]').attr("content");$('.articleBody a[data-atlas-trackable="body_exlink"]').each(function(d,e){$(this).attr("href",$(this).attr("data-url")+"?p=nbp."+c+"."+b);$(this).off("click")})}})();