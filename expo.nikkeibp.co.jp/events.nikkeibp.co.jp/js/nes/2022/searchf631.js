(function(f,a,c){const e="/sites/events.nikkeibp.co.jp";const b={m:"/images/nes/2022/default_m.jpg"};const g={m:"/images/nes/2022/loading.gif"};let SearchList=function(){};SearchList.prototype.getData=function(k){const l=$.Deferred();const m=this;const j=this.baseUrl();const h={output:"JSON",query:this.query+"&start="+(this.rows*(k.page-1)),decode:"true"};$.ajax({type:"POST",url:j,data:h,dataType:"json"}).done(function(n){let imagePaths=[];if(n.docs.length){n.docs.forEach(function(o){let image=o.TypicalImageM!==""?e+o.Url+o.TypicalImageM:e+b.m;imagePaths.push(image)})}l.resolve({articles:n.docs,hits:parseInt(n.hits),imagePaths:imagePaths,page:k.page,maxPage:Math.ceil(n.hits/m.rows)})}).fail(function(){l.reject({})});return l.promise()};SearchList.prototype.getBpimage=function(k){const l=$.Deferred();if(k.hasOwnProperty("imagePaths")&&k.imagePaths.length>0){const j=c.bpsearchOrigin()+"/ALL/img2bpimage.json";const h={path:k.imagePaths.join(","),size:2};$.ajax({type:"POST",url:j,data:h,dataType:"json"}).done(function(m){l.resolve($.extend({},k,{bpimages:m.result}))}).fail(function(){l.resolve(k)})}else{l.resolve(k)}return l.promise()};SearchList.prototype.listHtml=function(l){const n=this;const m=function(o){let html="";if(o.CatchPhrase!==""){html+="<span>"+c.sanitize(c.exTrim(o.CatchPhrase))+"</span>"}if(o.CCateId==="nes_EVENT"){if(o.SeminarSeries){html+=c.sanitize(c.exTrim(o.SeminarSeries))}}else{if(o.ParentPath!==""&&o.ParentTitle!==""){html+='<a href="'+o.ParentPath.replace(e,"").replace("index-2.html","")+'">'}if(o.ParentTitle!==""){html+=c.sanitize(c.exTrim(o.ParentTitle))}if(o.ParentPath!==""&&o.ParentTitle!==""){html+="</a>"}}return html!==""?'<p class="parent">'+html+"</p>":""};const j=function(o){let date="";if(o.CCateId==="nes_EVENT"){if(o.SeminarDate!==""){date=c.sanitize(c.getSubstring(c.stripTags(c.exTrim(o.SeminarDate)),60))}else{if(o.EventStartTime!==""&&o.EventEndTime!==""){const p="YYYY年M月D日（E）";date=c.formatDate(o.EventStartTime,"",p)+"から"+c.formatDate(o.EventEndTime,"",p)+"まで開催"}}}else{date=c.formatDate(o.DisplayDate,o.PublishFrom)}return date!==""?"<span>"+date+"</span>":""};const k=function(o){const p=o.slice(0,1);let h=o.slice(1);switch(p){case"T":case"E":try{const r=n.searchThemeInfo.filter(function(s){return s.value===h});h=r[0].name}catch(q){return""}break;default:break}return h};const h=function(o){let tags=[];o.Keyword.split("\t").forEach(function(p){if(p!==""){tags.push("K"+p)}});o.ThemeId.split("\t").forEach(function(p){if(p!==""){tags.push("T"+p)}});o.ExtensionTag.split("\t").forEach(function(p){if(p!==""&&p.slice(4,1)=="F"){tags.push("E"+p)}});if(tags.length>3){tags=c.shuffle(tags)}let html="";if(tags.length){html+='<ul class="tag">';tags.slice(0,3).forEach(function(p){html+='<li><a href="/tag/?tag='+encodeURIComponent(p)+'">#'+c.sanitize(k(p))+"</a></li>"});html+="</ul>"}return html};let html="";l.articles.forEach(function(o,p){html+='<div class="listL">';html+='<a href="'+(o.LinkUrl!==""?o.LinkUrl:o.Url)+'">';html+='<div class="img">';html+='<img class="img2bpimage" src="'+g.m+'" data-src="'+l.imagePaths[p]+'" alt="'+c.sanitize(c.exTrim(o.Title))+'">';html+="</div>";html+="</a>";html+='<div class="txt">';html+=m(o);html+='<a href="'+(o.LinkUrl!==""?o.LinkUrl:o.Url)+'">';html+="<h3>";html+=c.sanitize(c.exTrim(o.Title));html+=j(o);html+="</h3>";if(o.Description!==""){html+="<p>"+c.sanitize(c.getSubstring(c.stripTags(c.exTrim(o.Description)),220))+"</p>"}html+="</a>";html+="</div>";html+=h(o);html+="</div>"});return html};SearchList.prototype.pagenationHtml=function(h){const k=this.queryString;let pageNum=5;if(h.maxPage<pageNum){pageNum=h.maxPage}const j=Math.floor(pageNum/2);let start=h.page-j;let end=h.page+j;if(start<=0){start=1;end=pageNum}if(end>h.maxPage){start=h.maxPage-pageNum+1;end=h.maxPage}let html="";if(h.page>1){html+='<li class="prev"><a href="'+k+(h.page>2?"&p="+(h.page-1):"")+'"><span></span></a></li>'}for(let i=start;i<=end;i++){html+="<li"+(h.page!=i?"":' class="active"')+'><a href="'+k+(i!=1?"&p="+i:"")+'"><span>'+i+"</span></a></li>"}if(h.maxPage!=h.page){html+='<li class="next"><a href="'+k+"&p="+(h.page+1)+'"><span></span></a></li>'}return html};SearchList.search=function(){this.type="search";this.rows=30;this.el={};this.init=function(h){this.el.searchArea=a.getElementById("searchArea");this.setSearchForm(h);this.searchThemeInfo=this.getSeachThemeInfo();this.query=this.createSolrQuery(h,this.searchThemeInfo);this.queryString=this.createQueryString(h);return true},this.createSolrQuery=function(o,n){const h=function(q){return q.replace(/　/g," ").replace(/ +/g," ").split(" ").map(function(r){return'content_kuromoji:"'+encodeURIComponent(r)+'"'}).join(" AND ")};const m=function(){const q=[];if(o.hasOwnProperty("period")&&o.period!==""){o.period.split(",").forEach(function(r){if(r.length==7&&!isNaN(new Date(r).getTime())){q.push(r)}})}let isSelectedEndEvent=o.hasOwnProperty("event")&&o.event.indexOf("end")>-1?true:false;let k="";if(q.length){k=q.map(function(r){const t=new Date(r+"-01");const s=t.setMonth(t.getMonth()+1);let query="EventStartTime_ja_dt:[* TO "+c.formatDate(s,"","YYYY-MM-DD")+"T00:00:00Z-9HOURS-1SECOND] AND EventEndTime_ja_dt:["+r+"-01T00:00:00Z-9HOURS TO *]";if(!isSelectedEndEvent){query+=" AND EventEndTime_ja_dt:[NOW TO *]"}return"("+query+")"}).join(" OR ")}else{if(isSelectedEndEvent){}else{k="(EventEndTime_ja_dt:[NOW TO *])"}}return k};const l=function(s){const r={T:"ThemeId_ja_smv",E:"ExtensionTag_ja_smv"};const q=[];s.split(",").map(function(u){try{let target=n.filter(function(v){return v.id===u});q.push(r[u.slice(0,1)]+":"+target[0].value)}catch(t){}});return q.join(" OR ")};const j=[];j.push("q=("+h(o.KEYWORD)+")");const k=m();if(k!==""){j.push("fq=("+k+")")}if(o.hasOwnProperty("theme")&&o.theme!==""){const p=l(o.theme);if(p!==""){j.push("fq=("+p+")")}}if(o.hasOwnProperty("event")&&o.event!==""){if(o.event.indexOf("free")>-1){j.push("fq=-(Price_ja_ti:[* TO *] AND -Price_ja_ti:0) AND -(BookSeminarSale_Price_ja_s:[* TO *] AND -BookSeminarSale_Price_ja_s:0)")}}return j.join("&")+"&rows="+this.rows},this.baseUrl=function(){return"/js/nes/2022/query.js"},this.setSearchForm=function(h){this.el.searchArea.querySelector('[name="KEYWORD"]').value=h.KEYWORD;if(h.hasOwnProperty("period")&&h.period!==""){h.period.split(",").forEach(function(j){let el=this.el.searchArea.querySelector('[name="period"][value="'+j+'"]');if(el){el.checked=true}}.bind(this))}if(h.hasOwnProperty("theme")&&h.theme!==""){h.theme.split(",").forEach(function(j){let el=this.el.searchArea.querySelector('[name="theme"][value="'+j+'"]');if(el){el.checked=true}}.bind(this))}if(h.hasOwnProperty("event")&&h.event!==""){h.event.split(",").forEach(function(j){let el=this.el.searchArea.querySelector('[name="event"][value="'+j+'"]');if(el){el.checked=true}}.bind(this))}},this.createQueryString=function(j){const h=[];Object.keys(j).forEach(function(k){if(/^(KEYWORD|period|theme|event)$/.test(k)){h.push(k+"="+encodeURIComponent(j[k]))}});return h.length?"?"+h.join("&"):""},this.getSeachThemeInfo=function(){const j=[];const h=c.toArray(this.el.searchArea.querySelectorAll('[name="theme"]'));h.forEach(function(k){let type=k.value.slice(0,1);let names=k.dataset.nesSearch.match(/^(.+)_(.+?)$/);if(type==="T"){j.push({id:k.value,value:names[1],name:names[2]})}else{if(type==="E"){j.push({id:k.value,value:names[0],name:names[2]})}}});return j}};const d={type:"search",init:function(){SearchList[this.type].prototype=new SearchList();this.seachList=new SearchList[this.type]();const h=c.locationQueryParams();if(!h.hasOwnProperty("KEYWORD")||(h.hasOwnProperty("KEYWORD")&&h.KEYWORD==="")){return false}this.keyword=h.KEYWORD;this.page=h.hasOwnProperty("p")?c.filterInt(h.p):1;this.setDomElements();return this.seachList.init(h)},setDomElements:function(){this.el={};this.el.result=a.getElementById("result");this.el.resultList=this.el.result.querySelector(".col3");this.el.pagination=this.el.result.querySelector(".pagination");this.el.noSearchResults=this.el.result.querySelector(".noresult")},search:function(){const h=this;this.seachList.getData({page:this.page}).then(function(k){const l=h.seachList.listHtml(k);if(l!==""){h.el.result.querySelector(".ttl").style.display="block";h.el.resultList.insertAdjacentHTML("beforeend",l);const j=h.seachList.pagenationHtml({page:k.page,maxPage:k.maxPage});if(j!==""){h.el.pagination.querySelector("ul").insertAdjacentHTML("beforeend",j);h.el.pagination.style.display="block"}}else{h.el.result.querySelector(".ttl").style.display="block";h.el.noSearchResults.querySelector("p").insertAdjacentHTML("beforeend","「"+c.sanitize(h.keyword)+"」の検索結果はありません。");h.el.resultList.style.display="none";h.el.noSearchResults.style.display="block"}return h.seachList.getBpimage(k)}).then(function(j){const k=c.toArray(h.el.resultList.querySelectorAll(".img2bpimage"));k.forEach(function(m){const l=h.srcToBpimage(j,m.dataset.src);m.setAttribute("src",l);m.classList.remove("img2bpimage")})}).fail(function(){}).always(function(){})},srcToBpimage:function(k,j){let defaultImg=b.m;if(!k.hasOwnProperty("bpimages")){return defaultImg}const h=k.bpimages.filter(function(l){return l[j]});let bpimage=defaultImg;if(h.length){bpimage=h[0][j]}return bpimage}};f.addEventListener("DOMContentLoaded",function(){if(d.init()){d.search()}})})(window,document,nesUtils);