(function(n){function a(){var t=function(n,i){jQuery(n).length?i():r<=3&&(r++,setTimeout(function(){t(n,i)},100))};t(".addToMyAgenda",function(){r=0;n(".addToMyAgenda").configureMyAgendaButton()})}function v(){var i=parseInt(y("addToAgenda"),10);i&&t&&n.inArray(i,t)===-1?b(i):e.resolve()}function y(n){for(var i,u=window.location.search.substring(1),r=u.split("&"),t=0;t<r.length;t++)if(i=r[t].split("="),i[0]==n)return i[1]}function p(){n("#ma-login-modal").html(CES.templates.loginModal({title:"Sign In",description:"To add items to a personalized agenda, you need to sign in to your CES Account."}))}function s(i){var e=n(i),o=e.data("id"),s={id:o,notLoggedIn:!t,added:n.inArray(o,t)!==-1},r=n(CES.templates.scheduleCardAgendaButton(s)),u,f;e.replaceWith(r);r.hasClass("agenda-btn-add")&&t?r.click(l):t?(u=r.find("button"),u!==null&&u.click(k),f=r.find("a"),f!==null&&f.click(function(){window.location="/my-agenda.aspx"})):(r.attr("data-toggle","modal"),r.attr("data-target","#modal-message"),r.click(d))}function h(){u||(u=!0,n.ajax({type:"GET",url:"/api/MyAgenda?includeDeleted=false",headers:{apikey:apiKey,accesstoken:accessToken,"cache-control":"no-cache, no-store","ctaapi-version":myAgendaApiVer},contentType:"application/json"}).done(function(n,i,r){r.status===204?t=[]:n!==undefined&&n!==null&&(t=n.myAgendaItems.map(function(n){return n.sessionId}))}).fail(function(n){n.status===401&&(t=null)}).always(function(){u=!1;f.resolve()}))}function w(t){if(!i){i=!0;var u=n(this);t.preventDefault();const r=document.querySelectorAll(".agenda-btn-add");if(r.length<=0){console.error("There are no unlocked sessions available");return}for(let n=0;n<r.length;n++){const t=r[n],i=t.dataset("id"),u=n===r.length-1;c(i,u)}}}function b(i){n.ajax({type:"POST",url:"/api/MyAgenda",data:JSON.stringify({SessionId:i}),headers:{apiKey:apiKey,accesstoken:accessToken,"ctaapi-version":myAgendaApiVer},contentType:"application/json"}).done(function(n,r,u){u.status===201&&t.push(i)}).fail(function(){alert("There was an error adding to your agenda.")}).always(function(){e.resolve()})}function c(r,u){(u===null||typeof u=="undefined")&&(u=!1);var f=r.data("id");n.ajax({type:"POST",url:"/api/MyAgenda",data:JSON.stringify({SessionId:f}),headers:{apiKey:apiKey,accesstoken:accessToken,"ctaapi-version":myAgendaApiVer},contentType:"application/json"}).done(function(n,i,e){u&&(window.location="/my-agenda.aspx");e.status===201&&(t.push(f),s(r))}).fail(function(){alert("There was an error adding to your agenda.")}).always(function(){i=!1})}function l(t){if(!i){i=!0;var r=n(this);t.preventDefault();c(r,!1)}}function k(t){var r,u;i||(i=!0,r=n(this),t.preventDefault(),u=r.data("id"),n.ajax({type:"DELETE",url:"/api/MyAgenda/"+r.data("id"),headers:{apikey:apiKey,accesstoken:accessToken,"ctaapi-version":myAgendaApiVer}}).done(function(){var t=n(CES.templates.scheduleCardAgendaButton({added:!1,id:u}));r.parent().replaceWith(t);t.click(l);h()}).fail(function(){alert("There was an error removing from your agenda.")}).always(function(){i=!1}))}function d(t){var r=n(this),i;t.preventDefault();i=window.location.pathname+"?addToAgenda="+r.data("id");n("#login-modal-login").attr("href","/Login.aspx?returnurl="+i);n("body").addClass("blur")}var r,u,i;myAgendaApiVer="1.1";n.fn.extend({configureMyAgendaButton:function(){return this.each(function(){s(this)})}});Handlebars.registerPartial("scheduleCardAgendaButton",CES.templates.scheduleCardAgendaButton);var t,f=n.Deferred(),o=n.Deferred(),e=n.Deferred();n.when(f).done(v);n.when(f,e,o).done(a);p();h();n(document).ready(function(){const n=document.querySelectorAll("button.add-speaker-alt");for(let t=0;t<n.length;t++){const i=n[t];i.addEventListener("click",w)}o.resolve()});r=0;u=!1;i=!1})($);