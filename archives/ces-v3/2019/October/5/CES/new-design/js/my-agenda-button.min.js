(function(n){function s(t){var u=n(t),f=u.data("id"),e={id:f,notLoggedIn:!i,added:n.inArray(f,i)!==-1},r=n(CES.templates.scheduleCardAgendaButton(e));u.replaceWith(r);r.hasClass("agenda-btn-add")&&i?r.click(o):i?r.hasClass("ces-btn--remove-from-agenda")&&r.click(h):r.click(c)}function e(){r||(r=!0,n.ajax({type:"GET",url:"/api/MyAgenda",headers:{apikey:apiKey,accesstoken:accessToken},contentType:"application/json"}).done(function(n){i=n.myAgendaItems.map(function(n){return n.id})}).fail(function(n){n.status===401&&(i=null)}).always(function(){r=!1;u.resolve()}))}function o(i){if(!t){t=!0;var r=n(this);i.preventDefault();n.ajax({type:"POST",url:"/api/MyAgenda",data:JSON.stringify({MyAgendaItemId:r.data("id")}),headers:{apikey:apiKey,accesstoken:accessToken},contentType:"application/json"}).done(function(){window.location="/my-agenda.aspx"}).fail(function(){alert("There was an error adding to your agenda.")}).always(function(){t=!1})}}function h(i){if(!t){t=!0;var r=n(this);i.preventDefault();n.ajax({type:"DELETE",url:"/api/MyAgenda/"+r.data("id"),headers:{apikey:apiKey,accesstoken:accessToken}}).done(function(){var t=n(CES.templates.scheduleCardAgendaButton({added:!1,id:r.data("id")}));r.replaceWith(t);t.click(o);e()}).fail(function(){alert("There was an error removing from your agenda.")}).always(function(){t=!1})}}function c(t){var i=n(this);t.preventDefault();window.location="/Login.aspx?returnurl=/my-agenda.aspx?addToAgenda="+i.data("id")}var i,u,f,r,t;n.fn.extend({configureMyAgendaButton:function(){return this.each(function(){s(this)})}});Handlebars.registerPartial("scheduleCardAgendaButton",CES.templates.scheduleCardAgendaButton);e();u=n.Deferred();f=n.Deferred();n.when(u,f).done(function(){n(".addToMyAgenda").configureMyAgendaButton()});n(document).ready(function(){f.resolve()});r=!1;t=!1})($);