if(!window.__MIXI_PLUGINS__){var hostRegExp=new RegExp(/^\https?:\/\/([\w.:]+)\/?$/);window.__MIXI_PLUGINS__={_inited:false,_host:{plugins:function(){try{var pluginsElement=document.querySelector("div[data-plugins-type]");var hostUri=pluginsElement.getAttribute("data-host-uri");if(hostUri)return hostUri;var prefix=Mixi.Gateway.getParam("url_mixi_plugin_prefix");return prefix.match(hostRegExp)[1]}catch(e){return"plugins.mixi.jp"}}(),www:function(){try{var prefix=Mixi.Gateway.getParam("url_mixi_prefix");return prefix.match(hostRegExp)[1]}catch(e){return"www.mixi.jp"}}()},_set:function(targetElement,providers,override,srcElement){for(var name in providers){if(override||typeof targetElement[name]==="undefined"){targetElement[name]=srcElement?srcElement(providers[name]):providers[name]}}return targetElement},create:function(packagename,defaultclass){var mx=window.__MIXI_PLUGINS__;var classname_arr=packagename?packagename.split("."):[];for(var i=0,n=classname_arr.length;i<n;i++){var classname=classname_arr[i];var classobj=mx[classname];if(!classobj){classobj=defaultclass&&i+1==n?defaultclass:{};mx[classname]=classobj}mx=classobj}return mx},provide:function(target,providers,override){var mx=window.__MIXI_PLUGINS__;return mx._set(mx.create(target),providers,override)}}}__MIXI_PLUGINS__.provide("Constants",{mixi_xd_proxy_name:"__mixi_xd_proxy",mixi_xd_origin:"__mixi_xd_origin"});__MIXI_PLUGINS__.provide("Array",{isArray:function(arr){if(!arr)return false;return Object.prototype.toString.apply(arr)==="[object Array]"||!(arr instanceof Function)&&typeof arr.length=="number"},forEach:function(arr,func){if(!arr)return;if(__MIXI_PLUGINS__.Array.isArray(arr)){for(var i=0,n=arr.length;i<n;i++){func(arr[i],i,arr)}}else{for(var element in arr){if(arr.hasOwnProperty(element)){func(arr[element],element,arr)}}}}});__MIXI_PLUGINS__.provide("String",{trim:function(str){return str.replace(/^\s*|\s*$/g,"")},isBlank:function(str){return!str||!__MIXI_PLUGINS__.String.trim(str).charAt(0)}});__MIXI_PLUGINS__.provide("",{config:null,init:function(){var mx=window.__MIXI_PLUGINS__;if(mx._inited)return;mx.ready(mx._init);mx._checkReady();mx._inited=true},_init:function(){var mx=window.__MIXI_PLUGINS__;var hash=mx.Encoder.hash();if(hash){mx.config=mx.Encoder.decode(hash)}else{mx.config={}}mx.PluginContainer.initPluginContainerElements();if(mx.PluginContainer.needCrossDomainProxy()){mx.Proxy.init(function(){mx.PluginContainer.tryCreatePlugins()})}else{mx.PluginContainer.tryCreatePlugins()}},$:function(id){return document.getElementById(id)},$t:function(tagname,parentElement){if(!tagname)return undefined;parentElement=parentElement||document;var elements=parentElement.getElementsByTagName(tagname);if(!elements||elements.length<1)return undefined;return elements},getDomain:function(name){var mx=window.__MIXI_PLUGINS__;var protocol;switch(name){case"plugins":protocol="https://";return protocol+mx._host.plugins+"/";case"www":protocol=window.location.protocol=="https:"?"https://":"http://";return protocol+mx._host.www+"/";default:break}},guid:function(prefix){prefix=prefix||"mixi";var ret="";for(var i=1;i<=8;i++){ret+=((1+Math.random())*65536|0).toString(16).substring(1)}return prefix+ret},_onReadyCallbacks:[],_onReady:function(){var mx=window.__MIXI_PLUGINS__;mx._ready=true;for(var i=0,n=mx._onReadyCallbacks.length;i<n;i++){mx._onReadyCallbacks[i]()}mx._onReadyCallbacks=[]},ready:function(func){var mx=window.__MIXI_PLUGINS__;if(mx._ready){window.setTimeout(func,10)}else{mx._onReadyCallbacks.push(func)}},_checkReady:function(){(function(){var timer;function fireContentLoadedEvent(){if(__MIXI_PLUGINS__._ready)return;if(timer)window.clearTimeout(timer);if(__MIXI_PLUGINS__._onReady)__MIXI_PLUGINS__._onReady()}if(__MIXI_PLUGINS__._ready||document.readyState=="complete"){return fireContentLoadedEvent()}function checkReadyState(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",checkReadyState);fireContentLoadedEvent()}}function pollDoScroll(){try{document.documentElement.doScroll("left")}catch(e){timer=setTimeout(pollDoScroll,10);return}fireContentLoadedEvent()}if(document.addEventListener){document.addEventListener("DOMContentLoaded",fireContentLoadedEvent,false)}else{document.attachEvent("onreadystatechange",checkReadyState);if(window==top)timer=setTimeout(pollDoScroll,10)}var oldonload=window.onload;window.onload=function(){fireContentLoadedEvent();if(oldonload){if(typeof oldonload=="string")eval(oldonload);else oldonload()}};window.onunload=function(){setTimeout(function(){document.body.style.display="none";location.reload()},100)}})()},bind:function(){var args=Array.prototype.slice.call(arguments);var func=args.shift(),object=args.shift();return function(){return func.apply(object,args.concat(Array.prototype.slice.call(arguments)))}},_createClass:function(){return function(){this.initialize.apply(this,arguments)}},Class:function(name,prototype){var mx=window.__MIXI_PLUGINS__;if(mx._classes[name])return mx._classes[name];var classobj=mx._createClass();classobj.prototype=prototype;mx.create(name,classobj);mx._classes[name]=classobj;return classobj},subclass:function(name,parent,prototype){var mx=window.__MIXI_PLUGINS__;if(mx._classes[name])return mx._classes[name];var parentobj=mx.create(parent);mx._set(prototype,parentobj.prototype);prototype._base=parentobj;prototype._super=function(funcname){var args=Array.prototype.slice.call(arguments,1);return parentobj.prototype[funcname].apply(this,args)};return mx.Class(name,prototype)},_classes:{}});__MIXI_PLUGINS__.provide("Encoder",{encode:function(obj){var attriArr=[];__MIXI_PLUGINS__.Array.forEach(obj,function(value,attri){if(value!==null&&typeof value!="undefined"){attriArr.push(encodeURIComponent(attri)+"="+encodeURIComponent(value))}});attriArr.sort();return attriArr.join("&")},decode:function(hash){if(!hash)return null;var ret={};var elements=hash.split("&");var components;for(var i=0,n=elements.length;i<n;i++){components=elements[i].split("=",2);if(components&&components[0])ret[decodeURIComponent(components[0])]=decodeURIComponent(components[1]||"")}return ret},hash:function(){var loc=window.location.toString();if(loc.indexOf("#")<1)return undefined;return loc.substr(loc.indexOf("#")+1)}});__MIXI_PLUGINS__.provide("UserAgent",{ie:function(){var mx=window.__MIXI_PLUGINS__;mx.UserAgent._init();return mx.UserAgent._ie},_inited:false,_init:function(){var mx=window.__MIXI_PLUGINS__;if(mx.UserAgent._inited)return;mx.UserAgent._inited=true;mx.UserAgent._ie=false;
/*@cc_on mx.UserAgent._ie = @_jscript_version; @*/}});__MIXI_PLUGINS__.provide("Proxy",{_type:null,_callbacks:{},_engine:null,init:function(onreadycallback){var mx=window.__MIXI_PLUGINS__;mx.Proxy._type="postmessage";mx.Proxy._engine=mx.Proxy.PostMessage;mx.Proxy.PostMessage.init(onreadycallback)},addMessageListener:function(callback){var mx=window.__MIXI_PLUGINS__;var callbackname=mx.guid();mx.Proxy._callbacks[callbackname]=callback;if(mx.Proxy._engine){mx.ready(function(){mx.Proxy._engine.initListener&&mx.Proxy._engine.initListener(callbackname)})}return callbackname},postMessage:function(message,relation){var mx=window.__MIXI_PLUGINS__;if(!mx.Proxy._engine)return;mx.ready(function(){if(mx.Proxy._engine.send){var config=mx.config;message.cb=window.name;mx.Proxy._engine.send(message,relation)}})},resolveRelation:function(relationstring){var relations=relationstring.split(".");var ret=window;for(var i=0,n=relations.length;i<n;i++){var relation=relations[i];var frameindex=/^frames\[['"]?([a-zA-Z0-9-_]+)['"]?\]$/.exec(relation);if(relation==="opener"||relation==="parent"||relation==="top"){ret=ret[relation]}else if(frameindex){ret=ret.frames[frameindex[1]]}else{throw new SyntaxError("Malformed id to resolve: "+relationstring+"("+relation+")")}}return ret},recv:function(message){var mx=window.__MIXI_PLUGINS__;if(typeof message=="string"){try{message=mx.Encoder.decode(message)}catch(err){message=undefined}}if(!message)return;if(message.cb){var callback=mx.Proxy._callbacks[message.cb];callback&&callback(message)}},PostMessage:{init:function(onreadycallback){onreadycallback&&onreadycallback()},initListener:function(callbackname){var mx=window.__MIXI_PLUGINS__;if(!mx.Proxy._listenerInited){var handler=mx.Proxy.PostMessage.onMessage;window.addEventListener?window.addEventListener("message",handler,false):window.attachEvent("onmessage",handler);mx.Proxy._listenerInited=true}},send:function(message,relation){var mx=window.__MIXI_PLUGINS__;var targetwindow=mx.Proxy.resolveRelation(relation||"parent");if(targetwindow){targetwindow.postMessage(mx.Encoder.encode(message),"*")}},onMessage:function(event){__MIXI_PLUGINS__.Proxy.recv(event.data)}}});__MIXI_PLUGINS__.provide("PluginContainer",{_PLUGIN_ROOT_ID:"__mixi_root__",_PLUGIN_CONTAINER_TAG_NAME:"div",_PLUGIN_ATTR_PREFIX:"data-",_callbacks:{},_plugins:{},_pluginPages:{},_pluginRoot:null,tryCreatePlugins:function(){var mx=window.__MIXI_PLUGINS__;mx.Array.forEach(mx.PluginContainer._plugins,function(plugin,name){plugin.impl.create(plugin.containers)})},_setPluginContainerElementDefaultStyle:function(pluginContainerElement){pluginContainerElement.style["display"]="inline-block";pluginContainerElement.style["border"]="0";return pluginContainerElement},initPluginContainerElements:function(){var mx=window.__MIXI_PLUGINS__;var divElements=mx.$t(mx.PluginContainer._PLUGIN_CONTAINER_TAG_NAME);if(divElements){var _plugins=mx.PluginContainer._plugins;mx.Array.forEach(divElements,function(element){var type=element.getAttribute(mx.PluginContainer._PLUGIN_ATTR_PREFIX+"plugins-type");if(typeof type=="string"&&_plugins[type]){_plugins[type].containers.push(mx.PluginContainer._setPluginContainerElementDefaultStyle(element))}})}mx.PluginContainer._pluginRoot=mx.$(mx.PluginContainer._PLUGIN_ROOT_ID)},getPluginContainerAttributes:function(names,pluginContainerElement,attributes){if(!attributes)attributes={};if(!names||!pluginContainerElement)return attributes;var mx=window.__MIXI_PLUGINS__;mx.Array.forEach(names,function(name){attributes[name]=pluginContainerElement.getAttribute(mx.PluginContainer._PLUGIN_ATTR_PREFIX+name.replace("_","-"))});return attributes},needCrossDomainProxy:function(){var mx=window.__MIXI_PLUGINS__;var need=false;mx.Array.forEach(mx.PluginContainer._plugins,function(plugin){need=need||plugin.impl.needCrossDomainProxy});return need},isInPluginFrame:function(){var mx=window.__MIXI_PLUGINS__;var loc=window.location;if(loc.host!==__MIXI_PLUGINS__._host.plugins)return false;return!!mx.PluginContainer._pluginPages[loc.pathname]},regist:function(plugin){var mx=window.__MIXI_PLUGINS__;if(!plugin||!plugin.name)throw new Error("plugin null point exception.");if(mx.PluginContainer._plugins[plugin.name])return;else if(!plugin["create"]||typeof plugin["create"]!="function")throw new Error("plugin must be have create function.");mx.PluginContainer._plugins[plugin.name]={impl:plugin,containers:[]};if(plugin["pages"]){mx.Array.forEach(plugin["pages"],function(page){if(typeof page!="string"||page.length<1)return;if(page[0]!=="/")page="/"+page;mx.PluginContainer._pluginPages[page]=true})}},register:function(plugin){this.regist(plugin)}});__MIXI_PLUGINS__.Class("IframeWidget",{_pluginContainerElement:null,_frameElement:null,_frameId:null,_checkAndSetPluginContainerElement:function(element){this._pluginContainerElement=element;if(!this._pluginContainerElement)throw new Error("Can't get plugin container tag!"+window.location.toString());return this._pluginContainerElement},_formatRectParam:function(param){if(!param)return null;param+="";if(param.match("px$")!="px")param+="px";return param},_createFrame:function(frameParam,isHidden){var mx=window.__MIXI_PLUGINS__;var stylestr="border:0; overflow:hidden";var callbackid=mx.guid();var createFlg=false,inited=false;var parent;mx.PluginContainer._callbacks[callbackid]=function(){if(createFlg&&!inited){inited=true;frameParam.onload&&frameParam.onload(parent.firstChild)}};if(frameParam.width)stylestr+=";width:"+this._formatRectParam(frameParam.width);if(frameParam.height)stylestr+=";height:"+this._formatRectParam(frameParam.height);if(frameParam.position)stylestr+=";position:"+frameParam.position;if(frameParam.visibility)stylestr+=";visibility:"+frameParam.visibility;if(frameParam.display)stylestr+=";display:"+frameParam.display;if(frameParam.top)stylestr+=";top:"+this._formatRectParam(frameParam.top);if(frameParam.left)stylestr+=";left:"+this._formatRectParam(frameParam.left);stylestr+=";";var frameId=frameParam.name||mx.guid();var frameName=frameParam.name||frameId;if(!isHidden){parent=this._pluginContainerElement.appendChild(document.createElement("span"))}else{var p=document.createElement("div");var style=p.style;style.position="absolute";style.top="-10000px";style.width=style.height=0;parent=this._pluginContainerElement.appendChild(p)}if(document.attachEvent){var htmlstr="<iframe "+' id="'+frameId+'"'+' src="'+frameParam.src+'"'+' name="'+frameName+'"'+' frameborder="0"'+' scrolling="no"'+' allowTransparency="true"'+' style="'+stylestr+'"'+' onload="__MIXI_PLUGINS__.PluginContainer._callbacks.'+callbackid+'()"'+"></iframe>";parent.innerHTML=htmlstr;createFlg=true}else{var frame;frame=document.createElement("iframe");frame.id=frameId;frame.onload=mx.PluginContainer._callbacks[callbackid];frame.setAttribute("frameborder","0");frame.setAttribute("allowTransparency","true");frame.setAttribute("style",stylestr);frame.scrolling="no";frame.setAttribute("src",frameParam.src);frame.name=frameName;parent.appendChild(frame);createFlg=true}return frameId},getFrame:function(frameId){frameId=frameId||this._frameId;if(!this._frameElement)this._frameElement=document.getElementById(this._frameId);return this._frameElement}});__MIXI_PLUGINS__.provide("FavoriteConstants",{favorite_button_url:"favorite.pl",favorite_comment_url:"favorite_comment.pl",version:1,layout_vertical:1,layout_horizontal:2});__MIXI_PLUGINS__.provide("FavoriteConstants",{favorite_default_configurations:{small:{button:{width:52,height:15},count:{width:45,height:15,layout:__MIXI_PLUGINS__.FavoriteConstants.layout_horizontal},faces:{width:170,height:30,layout:__MIXI_PLUGINS__.FavoriteConstants.layout_vertical,max:10},face:{width:30,height:30,layout:__MIXI_PLUGINS__.FavoriteConstants.layout_horizontal,spacing:4}},medium:{button:{width:70,height:20},count:{width:65,height:20,layout:__MIXI_PLUGINS__.FavoriteConstants.layout_horizontal},faces:{width:225,height:50,layout:__MIXI_PLUGINS__.FavoriteConstants.layout_vertical,max:10},face:{width:40,height:40,layout:__MIXI_PLUGINS__.FavoriteConstants.layout_horizontal,spacing:5}},large:{button:{width:70,height:20},count:{width:70,height:40,layout:__MIXI_PLUGINS__.FavoriteConstants.layout_vertical},faces:{width:225,height:50,layout:__MIXI_PLUGINS__.FavoriteConstants.layout_vertical,max:10},face:{width:40,height:40,layout:__MIXI_PLUGINS__.FavoriteConstants.layout_horizontal,spacing:5}}}});__MIXI_PLUGINS__.provide("FavoriteUtil",{_clone:function(srcElement){var mx=window.__MIXI_PLUGINS__;var targetElement={};for(var name in srcElement){if(typeof srcElement[name]=="object"){targetElement[name]=mx.FavoriteUtil._clone(srcElement[name])}else{targetElement[name]=srcElement[name]}}return targetElement},createFavoriteConfig:function(type,showCount,showFaces,width){var mx=window.__MIXI_PLUGINS__;var util=mx.FavoriteUtil;var constants=mx.FavoriteConstants;var config;type=type||"medium";switch(type){case"medium":config=util._clone(constants.favorite_default_configurations.medium);break;case"large":config=util._clone(constants.favorite_default_configurations.large);break;default:throw new Error("Invalid Parameter!")}if(showCount!="1"&&!showCount!="yes"&showCount!="true"){config.count.width=0;config.count.height=0}if(showFaces!="1"&&!showFaces!="yes"&showFaces!="true"){config.faces.width=0;config.faces.height=0;config.faces.max=0}else{var facesWidth=width||config.faces.width;var faceSize=config.face.width+config.face.spacing;config.faces.max=Math.floor(facesWidth/faceSize);config.faces.width=faceSize*config.faces.max}return config}});__MIXI_PLUGINS__.subclass("FavoriteFrame","IframeWidget",{_commentFrame:null,_frameConfig:null,_callbackKey:null,_options:null,initialize:function(pluginContainerElement){this._options={};this._checkAndSetPluginContainerElement(pluginContainerElement);this._createFavoriteShowframe()},_computeDimension:function(srcSizeObj,targetConfigObj){var mx=window.__MIXI_PLUGINS__;switch(targetConfigObj.layout){case mx.FavoriteConstants.layout_vertical:srcSizeObj.width=Math.max(srcSizeObj.width,targetConfigObj.width);srcSizeObj.height=srcSizeObj.height+targetConfigObj.height;break;case mx.FavoriteConstants.layout_horizontal:srcSizeObj.width=srcSizeObj.width+targetConfigObj.width;srcSizeObj.height=Math.max(srcSizeObj.height,targetConfigObj.height);break;default:break}return srcSizeObj},_createFavoriteShowframe:function(){var mx=window.__MIXI_PLUGINS__;this._options=mx.PluginContainer.getPluginContainerAttributes(["href","service_key","width","show_faces","show_comment","show_count","size"],this._pluginContainerElement,this._options);var options=this._options;if(mx.String.isBlank(options["service_key"])){throw new Error("Invalid Parameter!")}if(mx.String.isBlank(options["href"])){options["href"]=window.location.toString()}var config=mx.FavoriteUtil.createFavoriteConfig(options["size"],options["show_count"],options["show_faces"],options["width"]);var frameSize={width:config.button.width,height:config.button.height};frameSize=this._computeDimension(frameSize,config.count);frameSize=this._computeDimension(frameSize,config.faces);if(options["width"]){frameSize.width=options["width"]}var frameUrl=mx.getDomain("plugins")+mx.FavoriteConstants.favorite_button_url;frameUrl+="?show_comment_in_frame=1&ver="+mx.FavoriteConstants.version;mx.Array.forEach(options,mx.bind(function(value,name){if(value)frameUrl+="&"+name+"="+encodeURIComponent(value)},this));this._callbackKey=mx.Proxy.addMessageListener(mx.bind(this.onMessage,this));this._frameConfig=config;this._frameId=this._createFrame({src:frameUrl,name:this._callbackKey,width:frameSize.width,height:frameSize.height})},_createCommnetFrame:function(){if(!this._commentFrame){this._commentFrame=new __MIXI_PLUGINS__.CommentFrame(this)}return this._commentFrame},onMessage:function(message){if(!message||!message.act)return;if(message.act==="create"){this._createCommnetFrame()}else{if(this._commentFrame)this._commentFrame.onMessage(message)}}});__MIXI_PLUGINS__.subclass("CommentFrame","IframeWidget",{_visible:false,_favoriteFrame:null,_commentWidth:400,_commentHeight:221,_interval:1,initialize:function(favoriteFrame){this._favoriteFrame=favoriteFrame;this._checkAndSetPluginContainerElement(document.body);this._createCommentframe(favoriteFrame._callbackKey)},_createCommentframe:function(favoriteCallBackKey){var mx=window.__MIXI_PLUGINS__;var options=this._favoriteFrame._options;var frameUrl=mx.getDomain("plugins")+mx.FavoriteConstants.favorite_comment_url;frameUrl+="?href="+encodeURIComponent(options["href"]);frameUrl+="&service_key="+options["service_key"];frameUrl+="#ftcb="+favoriteCallBackKey;var cb=mx.Proxy.addMessageListener(mx.bind(this.onMessage,this));this._frameId=this._createFrame({src:frameUrl,name:cb,top:"-10000",left:"0",position:"absolute",visibility:"hidden",width:this._commentWidth,height:this._commentHeight})},show:function(rect){if(!this._visible){var frame=this.getFrame();if(rect){frame.style["top"]=rect.top+"px";frame.style["left"]=rect.left+"px"}this._visible=true;frame.style["width"]=this._commentWidth+"px";frame.style["height"]=this._commentHeight+"px";frame.style["display"]="";frame.style["visibility"]="";frame.style["z-index"]="10001"}},hide:function(){if(this._visible){var frame=this.getFrame();this._visible=false;frame.style["display"]="none";frame.style["width"]="0px";frame.style["height"]="0px"}},_getWindowSize:function(){var _body=document.body;var _element=document.documentElement;return{height:Math.max(_body.scrollHeight+_body.offsetTop,_element.scrollHeight+_element.offsetTop,_body.clientHeight,_element.clientHeight),width:Math.max(_body.scrollWidth+_body.offsetLeft,_element.scrollWidth+_element.offsetLeft,_body.clientWidth,_element.clientWidth)}},onMessage:function(message){if(message.act==="show"){var mx=__MIXI_PLUGINS__;var clientrect=this._favoriteFrame.getFrame().getBoundingClientRect();var scrolltop=document.documentElement.scrollTop||document.body.scrollTop;var scrollleft=document.documentElement.scrollLeft||document.body.scrollLeft;var favoriteFrameConfig=this._favoriteFrame._frameConfig;var favoriteButtonDimension=favoriteFrameConfig.button;var topOffset=0;if(favoriteFrameConfig.count.layout==mx.FavoriteConstants.layout_vertical){topOffset=favoriteFrameConfig.count.height}var top=scrolltop+clientrect.top+topOffset+favoriteButtonDimension.height+this._interval;var left=scrollleft+clientrect.left;var contentSize=this._getWindowSize();if(contentSize.width>this._commentWidth&&contentSize.height>this._commentHeight){if(top+this._commentHeight>contentSize.height){top-=favoriteButtonDimension.height+this._commentHeight+2*this._interval;top=Math.max(top,0)}if(left+this._commentWidth>contentSize.width){left-=this._commentWidth-favoriteButtonDimension.width;left=Math.max(left,0)}}if(mx.UserAgent.ie()&&!window.HTMLCollection){var bodyElementBorder=2;top-=bodyElementBorder;left-=bodyElementBorder}this.show({top:top,left:left})}else if(message.act=="hide"){this.hide()}else if(message.act=="size_inited"){var height=parseInt(message.height,10);if(height){this._commentHeight=height}this.getFrame().style["display"]="none"}}});__MIXI_PLUGINS__.PluginContainer.regist({name:"mixi-favorite",pages:[__MIXI_PLUGINS__.FavoriteConstants.favorite_button_url,__MIXI_PLUGINS__.FavoriteConstants.favorite_comment_url],needCrossDomainProxy:true,create:function(containers){var mx=__MIXI_PLUGINS__;if(!mx.PluginContainer.isInPluginFrame()){mx.Array.forEach(containers,function(container,name){new mx.FavoriteFrame(container)})}}});__MIXI_PLUGINS__.init();